"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[9390],{8734:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>o,contentTitle:()=>a,default:()=>h,frontMatter:()=>l,metadata:()=>i,toc:()=>d});const i=JSON.parse('{"id":"Getting-Started/Step4-Stimulation","title":"Stimulation with the PG4","description":"This guide introduces the COSMIIC 4-Channel Pulse Generator (PG4), explaining its functionality and setup to generate basic pulses.","source":"@site/docs/Getting-Started/Step4-Stimulation.md","sourceDirName":"Getting-Started","slug":"/Getting-Started/Step4-Stimulation","permalink":"/Getting-Started/Step4-Stimulation","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":5,"frontMatter":{"sidebar_position":5},"sidebar":"docsSidebar","previous":{"title":"Controlling the System","permalink":"/Getting-Started/Step3-Software"},"next":{"title":"Examples","permalink":"/Getting-Started/Example-Code"}}');var s=t(4848),r=t(8453);const l={sidebar_position:5},a="Stimulation with the PG4",o={},d=[{value:"Required",id:"required",level:3},{value:"Hardware Overview",id:"hardware-overview",level:2},{value:"Connecting the Hardware / Stacking Modules",id:"connecting-the-hardware--stacking-modules",level:3},{value:"Monitoring Stimulation Pulses",id:"monitoring-stimulation-pulses",level:3},{value:"Stimulation Pulse Parameters",id:"stimulation-pulse-parameters",level:2},{value:"Configurable Parameters",id:"configurable-parameters",level:3},{value:"Pulse Control Methods",id:"pulse-control-methods",level:3},{value:"Programming a Pulse in MATLAB",id:"programming-a-pulse-in-matlab",level:2},{value:"Via the Profiler MATLAB app",id:"via-the-profiler-matlab-app",level:3},{value:"Via Command Line / Script",id:"via-command-line--script",level:3},{value:"Putting it all Together - Example Stimulation Script",id:"putting-it-all-together---example-stimulation-script",level:4}];function c(e){const n={a:"a",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",hr:"hr",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"stimulation-with-the-pg4",children:"Stimulation with the PG4"})}),"\n",(0,s.jsx)(n.p,{children:"This guide introduces the COSMIIC 4-Channel Pulse Generator (PG4), explaining its functionality and setup to generate basic pulses."}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h3,{id:"required",children:"Required"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"PM Development Board"}),"\n",(0,s.jsx)(n.li,{children:"PG4 Development Board"}),"\n",(0,s.jsx)(n.li,{children:"Optional: Any additional modules (PG4 and/or BP2 Development Boards) may be present while controlling one PG4 module"}),"\n",(0,s.jsx)(n.li,{children:"Wireless Link board + USB-C cable"}),"\n",(0,s.jsx)(n.li,{children:"MATLAB"}),"\n",(0,s.jsxs)(n.li,{children:["Local clone of the ",(0,s.jsx)(n.a,{href:"https://github.com/COSMIIC-Inc/NNP-API",children:(0,s.jsx)(n.strong,{children:"NNP-API"})})," Github repository"]}),"\n"]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"hardware-overview",children:"Hardware Overview"}),"\n",(0,s.jsx)(n.p,{children:"The PG4 Development Board consists of a PG4 module circuit board and an accompanying frame board for:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Network connection"}),"\n",(0,s.jsx)(n.li,{children:"Output monitoring"}),"\n",(0,s.jsx)(n.li,{children:"Accessory/electrode connection"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"PG4 dev board with labeled test connections",src:t(691).A+"",width:"1152",height:"864"})}),"\n",(0,s.jsx)(n.h3,{id:"connecting-the-hardware--stacking-modules",children:"Connecting the Hardware / Stacking Modules"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Requires a PM  Development Board to provide power and communication"}),"\n",(0,s.jsx)(n.li,{children:"Modules can be stacked or connected via twisted pair cables for distributed setups."}),"\n",(0,s.jsxs)(n.li,{children:["Follow the directions on ",(0,s.jsx)(n.strong,{children:(0,s.jsx)(n.a,{href:"/Getting-Started/Step1-Hardware",children:"Setting up the System - Hardware"})})," for connecting modules to the PM"]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"monitoring-stimulation-pulses",children:"Monitoring Stimulation Pulses"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Use oscilloscope on electrode outputs (touchproof or 2.54mm)."}),"\n",(0,s.jsx)(n.li,{children:"Measure all channels relative to anode."}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"Example setup for measuring stim output",src:t(7808).A+"",width:"1520",height:"632"})}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"stimulation-pulse-parameters",children:"Stimulation Pulse Parameters"}),"\n",(0,s.jsx)(n.p,{children:"The PG4 generates biphasic, passive charge balanced waveforms with adjustable pulse width, pulse amplitude, and stim frequency. Below is a timing diagram which shows the relationship of configurable stimulation parameters."}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"stimulation waveform diagram",src:t(9856).A+"",width:"1617",height:"756"})}),"\n",(0,s.jsx)(n.h3,{id:"configurable-parameters",children:"Configurable Parameters"}),"\n",(0,s.jsx)(n.p,{children:"The following stimulation parameters are configurable in software:"}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Parameter"}),(0,s.jsx)(n.th,{children:"Description"}),(0,s.jsx)(n.th,{children:"Range"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Pulse Width (PW)"}),(0,s.jsx)(n.td,{children:"Width in \xb5s"}),(0,s.jsx)(n.td,{children:"1\u2013255 \xb5s (1 us resolution)"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Pulse Amplitude (PA)"}),(0,s.jsx)(n.td,{children:"Amplitude in mA"}),(0,s.jsx)(n.td,{children:"0\u201320 mA (0.1 mA resolution)"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Inter-Phase Interval"}),(0,s.jsx)(n.td,{children:"Time between phases"}),(0,s.jsx)(n.td,{children:"5\u2013100 \xb5s (1 us resolution, default 50)"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Channel Period (SYNC)"}),(0,s.jsx)(n.td,{children:"Time between pulses (same channel)"}),(0,s.jsx)(n.td,{children:"10\u201365535 ms (1 us resolution, default 80)"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Between Channel Timing"}),(0,s.jsx)(n.td,{children:"Time between channel pulses"}),(0,s.jsx)(n.td,{children:"1 ms default"})]})]})]}),"\n",(0,s.jsx)(n.p,{children:"The operation of the network can be synced to a minimum cycle of 20ms. The Between Channel Timing adds 1 ms for each channel above channel 1 (e.g. channel 1 has a minimum SYNC period of 20 ms, channel 2 must be used with a SYNC greater than or equal to 21 ms... channel 4 must be used with a SYNC greater than or equal to 23 ms). To increase the frequency, certain details of the network operation must be altered to lessen the SYNC period or could be hard-coded directly into the PG4 firmware. PG4s have a hard-coded limit of 10 ms (10 Hz) which can theoretically be changed."}),"\n",(0,s.jsx)(n.h3,{id:"pulse-control-methods",children:"Pulse Control Methods"}),"\n",(0,s.jsx)(n.p,{children:"There are several methods to control the stimulation outputs:"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Direct parameter setting via PM"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Maximum ~50Hz update rate for up to 24 channels"}),"\n",(0,s.jsx)(n.li,{children:"Requires PDO configuration of PM and PG4"}),"\n",(0,s.jsx)(n.li,{children:"Recommended for testing patterns, or where preloaded patterns are undesirable"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Direct parameter setting via PG - SDO"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Maximum ~4Hz update rate for 12 channels, or ~50Hz for single channel"}),"\n",(0,s.jsx)(n.li,{children:"Requires the least amount of configuration"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Pattern based - Lookup table to map command level to PW/PA - SDO"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Maximum ~50Hz update rate for channels"}),"\n",(0,s.jsx)(n.li,{children:"Limited to 8 degrees-of-freedom (commands) in system"}),"\n",(0,s.jsxs)(n.li,{children:["Up to 48 channel patterns per PG4, with up to 20 breakpoints each","\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Linear interpolation between breakpoints"}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.li,{children:"Recommended for take-home or permanent systems"}),"\n",(0,s.jsx)(n.li,{children:"Maximum frequency limited by pulse set up time (~20Hz)"}),"\n",(0,s.jsx)(n.li,{children:"Requires patterns to be loaded into PG4"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.em,{children:"This guide will only focus on changing the PW, PA, and Channel Period via method 2, SDO."})}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"programming-a-pulse-in-matlab",children:"Programming a Pulse in MATLAB"}),"\n",(0,s.jsxs)(n.p,{children:["You will need to know how the node # of your PG4 module and how to interact with the NNP-API in MATLAB. Follow directions in ",(0,s.jsx)(n.strong,{children:(0,s.jsx)(n.a,{href:"/Getting-Started/Step3-Software",children:"Controlling the System - Software"})})," to initialize an instance of ",(0,s.jsx)(n.code,{children:"nnp=NNPHELPERS()"})," and use ",(0,s.jsx)(n.code,{children:"rmbootloader(nnp)"})," or ",(0,s.jsx)(n.code,{children:"netscanner(nnp)"})," to determine how your modules are mapped to nodes."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-matlab",children:"nnp=NNPHELPERS %\n"})}),"\n",(0,s.jsx)(n.h3,{id:"via-the-profiler-matlab-app",children:"Via the Profiler MATLAB app"}),"\n",(0,s.jsxs)(n.p,{children:["The Profiler app is a GUI used to trigger stimulation at individual channels. This can be used as an easy way to confirm the setup of your PG4 and to test out individual elicited responses to stimulation rather than using a coordinated pattern. Other applications, such as ",(0,s.jsx)(n.code,{children:"patternedit()"})," can be used to configure stimulation patterns to load directly to the PG4, but are not yet covered on this site."]}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["Make sure the network is ON by using ",(0,s.jsx)(n.code,{children:"nnp.networkOn"})," command or a button in another GUI. The LED on the PG4 should start flashing.","\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"The Profiler GUI will eventually give you option to turn the network on if it is not already on"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["Open the Profiler app by entering ",(0,s.jsx)(n.code,{children:"profiler(nnp)"})," into the MATLAB command window."]}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-matlab",children:"nnp.networkOn; % turn network ON. This enables commands from the Profiler app\nprofiler(nnp) % run profiler app through the COM port associated with the nnp instance\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"screenshot of profiler function&#39;s GUI view",src:t(6328).A+"",width:"512",height:"346"})}),"\n",(0,s.jsxs)(n.ol,{start:"3",children:["\n",(0,s.jsxs)(n.li,{children:["Select the ",(0,s.jsx)(n.code,{children:"node"})," and ",(0,s.jsx)(n.code,{children:"channel"})," of the PG4 module you wish to control"]}),"\n",(0,s.jsxs)(n.li,{children:["Set ",(0,s.jsx)(n.code,{children:"PA"})," and ",(0,s.jsx)(n.code,{children:"PW"})," to your intended levels","\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Note: Frequency default is 12.5 Hz or 80 ms SYNC period. See below how to change frequency on the command line"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["Select ",(0,s.jsx)(n.code,{children:"Stim On"})," and the GUIs background should turn green. Stimulation will adjust as you change ",(0,s.jsx)(n.code,{children:"PW"})," and ",(0,s.jsx)(n.code,{children:"PA"}),", but will terminate and must be re-selected if you change ",(0,s.jsx)(n.code,{children:"node"})," or ",(0,s.jsx)(n.code,{children:"channel"}),"."]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"via-command-line--script",children:"Via Command Line / Script"}),"\n",(0,s.jsx)(n.p,{children:"The following series of MATLAB commands can be used in scripts or in command line to generate stimulation pulses."}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["Identify your intended pulse frequency in Hz and convert to a SYNC period in ms","\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"SYNC period (ms) = 1000 / frequency"}),"\n",(0,s.jsx)(n.li,{children:"If intended frequency is 20 Hz, SYNC time = 1000 / 20 Hz = 50 ms"}),"\n",(0,s.jsxs)(n.li,{children:["We recommend using a minimum 23 ms (maximum 43.5 Hz) SYNC period for the reason listed above in the ",(0,s.jsx)(n.strong,{children:(0,s.jsx)(n.a,{href:"#configurable-parameters",children:"Configurable Parameters"})})," section"]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["Set frequency with ",(0,s.jsx)(n.code,{children:"nnp.setSync()"})," command in MATLAB","\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"The argument for setSync() is a time duration in ms"}),"\n",(0,s.jsxs)(n.li,{children:["Note: The network must be in waiting mode (",(0,s.jsx)(n.code,{children:"nnp.enterWaiting"}),") in order for the ",(0,s.jsx)(n.code,{children:"nnp.setSync()"})," command to be effective and change the frequency."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-matlab",children:"nnp.setSync(50); %sync period of 50 ms for 20 Hz frequency\n"})}),"\n",(0,s.jsxs)(n.ol,{start:"3",children:["\n",(0,s.jsx)(n.li,{children:"Enable stimulation by entering TestStim mode"}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-matlab",children:"nnp.enterTestStim; %enable stimulation mode\n"})}),"\n",(0,s.jsxs)(n.ol,{start:"4",children:["\n",(0,s.jsxs)(n.li,{children:["Identify your intended pulse width (PW) and pulse amplitude (PA)","\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"PW is a value 0-255 in us"}),"\n",(0,s.jsx)(n.li,{children:"PA is a value 0-200 in mA adjusted by a scale of 10."}),"\n",(0,s.jsx)(n.li,{children:"Example: If your intended waveform has a PW of 100 us and 5 mA, your values in the next step will be [100, 5*10] or [100, 50]"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["Use the ",(0,s.jsx)(n.code,{children:"nnp.write()"})," to set the stimulation parameters","\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["This function is used to overwrite data in Object Dictionary by the subindex. Use command ",(0,s.jsx)(n.code,{children:"doc NNPHELPERS"})," for more info."]}),"\n",(0,s.jsxs)(n.li,{children:["The standard arguments are ",(0,s.jsx)(n.code,{children:"dataOut = write(NNP, node, indexOD, subIndexOD, writeData)"})]}),"\n",(0,s.jsxs)(n.li,{children:["The Object Dictionary index ",(0,s.jsx)(n.code,{children:"indexOD"})," for stimulation parameters is ",(0,s.jsx)(n.code,{children:"0x3212"}),". This index is sectioned into subindices to represent 4 channels. At this index are 4 sets of stored values that are read by the PG4 to determine the PW and PA of the individual channels."]}),"\n",(0,s.jsxs)(n.li,{children:["Thus, in the case of setting stimulation parameters, the arguments are ",(0,s.jsx)(n.code,{children:"nnp.write(node, '3212', channel, [PW us, PA*10 mA])"})," and rewrite the PW and PA values at the ",(0,s.jsx)(n.code,{children:"0x3212.[channel]"})," subindex."]}),"\n",(0,s.jsxs)(n.li,{children:['Functionally "turn off the stimulation" by using another ',(0,s.jsx)(n.code,{children:"nnp.write()"})," at the same node and channel with ",(0,s.jsx)(n.code,{children:"[0, 0]"})," for ",(0,s.jsx)(n.code,{children:"writeData"})," to stop charge output on each Sync cycle. Note that the system remains in TestStim mode however."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-matlab",children:"nnp.write(5, '3212', 1, [50, 100]); %update stimulation parameters to be 50 us and 10 mA on node 5's channel 1\nnnp.write(5, '3212', 1, [0,0]); %update stimulation parameters to zeros to stop output of charge\n"})}),"\n",(0,s.jsxs)(n.ol,{start:"6",children:["\n",(0,s.jsx)(n.li,{children:"Exit stimulation mode by entering Waiting mode"}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-matlab",children:"nnp.enterWaiting; %enable stimulation mode\n"})}),"\n",(0,s.jsx)(n.h4,{id:"putting-it-all-together---example-stimulation-script",children:"Putting it all Together - Example Stimulation Script"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-matlab",metastring:'title="stimulationCommands.m"',children:"%% demonstrate stim on command line (recommended order of operations)\n\n%create instance of nnp for radio communication through Wireless Link\nnnp=NNPHELPERS();\n\n% prepare system for stim mode\nnnp.networkOn; % turn on network so PM can communicate with PG4s\nnnp.setSync(25); %25ms sync or (1000 / 25 ms) = 40 Hz frequency\nnnp.enterTestStim; % mode change to enable stimulation\n\n% turn on stimulation at one channel. Make sure you have the correct node #\nnnp.write(5, '3212', 1, [50,5*10]); %module at node 6, 'indexOD for stim', channel 1, 50ms pulsewidth, 5 mA pulseamp\n\n%Turn off stimulation\nnnp.write(5, '3212', 1, [0,0]);\n\n% Example: Set PW and PA on each channel\nnnp.write(5, '3212', 1, [50, 50]);   % Set channel 1 of node 5 to 50us, 5mA @ 40 Hz\nnnp.write(5, '3212', 2, [100, 100]); % Set channel 2 of node 5 to 100us, 10mA @ 40 Hz\nnnp.write(5, '3212', 3, [150, 150]); % Set channel 3 of node 5 to 150us, 15mA @ 40 Hz\nnnp.write(5, '3212', 4, [255, 200]); % Set channel 4 of node 5 to 255us, 20mA @ 40 Hz\n\n%transition from TestStim mode to Waiting. Stimulation will end.\nnnp.enterWaiting;\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.em,{children:"Congratulations! You\u2019ve generated stimulation pulses!"})})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(c,{...e})}):c(e)}},691:(e,n,t)=>{t.d(n,{A:()=>i});const i=t.p+"assets/images/PG4-Dev-Board-Labeled-df8b4d1f26e4327dcc67ead2a366a5f4.png"},7808:(e,n,t)=>{t.d(n,{A:()=>i});const i=t.p+"assets/images/PG4-Stim-Oscilloscope-893064d0c7f083498e99d2174e6746f5.png"},6328:(e,n,t)=>{t.d(n,{A:()=>i});const i=t.p+"assets/images/profiler-gui-0bb6709bc50e8a4c52c51159b1f96d44.png"},9856:(e,n,t)=>{t.d(n,{A:()=>i});const i=t.p+"assets/images/stimulation-waveform-2becdabd2cf3eac0cfd9460b87974e9e.png"},8453:(e,n,t)=>{t.d(n,{R:()=>l,x:()=>a});var i=t(6540);const s={},r=i.createContext(s);function l(e){const n=i.useContext(r);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:l(e.components),i.createElement(r.Provider,{value:n},e.children)}}}]);